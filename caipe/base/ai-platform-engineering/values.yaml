# Override values for idpbuilder local deployment - Base configuration
# Global configuration shared across all subcharts
global:
  # Disable graph RAG for now
  rag:
    enableGraphRag: false

  slim:
    enabled: false

  externalSecrets:
    enabled: true
    secretStoreRef:
      name: "vault-secret-store"
      kind: ClusterSecretStore

  agentSecrets:
    create: true

  llmSecrets:
    create: false
    secretName: "llm-secret"
    externalSecrets:
      secretStoreRef:
        name: "vault-secret-store"
        kind: ClusterSecretStore
      data:
      - secretKey: LLM_PROVIDER
        remoteRef:
          key: secret/ai-platform-engineering/global
          property: LLM_PROVIDER

      # Azure OpenAI configuration
      - secretKey: AZURE_OPENAI_API_KEY
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AZURE_OPENAI_API_KEY
      - secretKey: AZURE_OPENAI_ENDPOINT
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AZURE_OPENAI_ENDPOINT
      - secretKey: AZURE_OPENAI_API_VERSION
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AZURE_OPENAI_API_VERSION
      - secretKey: OPENAI_API_VERSION
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AZURE_OPENAI_API_VERSION
      - secretKey: AZURE_OPENAI_DEPLOYMENT
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AZURE_OPENAI_DEPLOYMENT
      # OpenAI configuration
      - secretKey: OPENAI_API_KEY
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: OPENAI_API_KEY
      - secretKey: OPENAI_ENDPOINT
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: OPENAI_ENDPOINT
      - secretKey: OPENAI_MODEL_NAME
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: OPENAI_MODEL_NAME
      # AWS Bedrock configuration
      - secretKey: AWS_ACCESS_KEY_ID
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AWS_ACCESS_KEY_ID
      - secretKey: AWS_SECRET_ACCESS_KEY
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AWS_SECRET_ACCESS_KEY
      - secretKey: AWS_REGION
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AWS_REGION
      - secretKey: AWS_BEDROCK_MODEL_ID
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AWS_BEDROCK_MODEL_ID
      - secretKey: AWS_BEDROCK_PROVIDER
        remoteRef:
          conversionStrategy: Default
          decodingStrategy: None
          key: secret/ai-platform-engineering/global
          property: AWS_BEDROCK_PROVIDER

promptConfigType: "deep_agent"

supervisor-agent:
  nameOverride: "supervisor-agent"
  image:
    repository: "ghcr.io/cnoe-io/ai-platform-engineering"
    tag: "0.2.4"
  env:
    EXTERNAL_URL: "https://cnoe.localtest.me:8443/ai-platform-engineering"
    RAG_AGENT_PORT: 8099

    # Agent Connectivity Configuration
    AGENT_CONNECTIVITY_ENABLE_BACKGROUND: "true"  # Routinely checks each subagent connectivity to add or remove any from existing tools list
    SKIP_AGENT_CONNECTIVITY_CHECK: "false"  # Do not skip the connectivity check; supervisor agent will check each subagent is reachable

    # Orchestration and Streaming Configuration
    ENABLE_ENHANCED_STREAMING: "false"  # Enable enhanced streaming with intelligent routing (DIRECT/PARALLEL/COMPLEX modes)
    FORCE_DEEP_AGENT_ORCHESTRATION: "true"  # Force all queries through Deep Agent with parallel orchestration hints (DEFAULT - best performance)
    ENABLE_ENHANCED_ORCHESTRATION: "false"  # EXPERIMENTAL: Smart routing + orchestration hints (4th mode for comparison)
    STREAM_SUB_AGENT_TOOL_OUTPUT: "true"  # Stream intermediate tool outputs (ðŸ“„) from sub-agents to end user

    # Response Format Configuration
    ENABLE_STRUCTURED_OUTPUT: "false"  # Set to "true" to enforce execution plans with Pydantic validation
    ENABLE_ARTIFACT_STREAMING: "true"

    # # OAuth2 Configuration
    A2A_AUTH_OAUTH2: true
    # Backstage authentication
    # JWKS_URI and TOKEN_ENDPOINT use internal cluster service to avoid SSL issues
    # ISSUER must match the external URL because that's what's in the JWT tokens
    JWKS_URI: "http://backstage.backstage.svc.cluster.local:7007/api/auth/.well-known/jwks.json"
    AUDIENCE: "backstage"
    ISSUER: "https://cnoe.localtest.me:8443/api/auth"
    OAUTH2_CLIENT_ID: "backstage"
    TOKEN_ENDPOINT: "http://backstage.backstage.svc.cluster.local:7007/api/auth/oauth2/token"

agent-argocd:
  nameOverride: "agent-argocd"
  image:
    repository: "ghcr.io/cnoe-io/agent-argocd"
    tag: "0.2.4"
    pullPolicy: "Always"
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-argocd"
      tag: "0.2.4"
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
  agentSecrets:
    secretName: "agent-argocd-secret"
    externalSecrets:
      data:
      - secretKey: ARGOCD_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/argocd-secret
          property: ARGOCD_TOKEN
      - secretKey: ARGOCD_API_URL
        remoteRef:
          key: secret/ai-platform-engineering/argocd-secret
          property: ARGOCD_API_URL
      - secretKey: ARGOCD_VERIFY_SSL
        remoteRef:
          key: secret/ai-platform-engineering/argocd-secret
          property: ARGOCD_VERIFY_SSL

agent-aws:
  nameOverride: "agent-aws"
  image:
    repository: "ghcr.io/cnoe-io/agent-aws"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    mode: "stdio" # AWS currently does not support HTTP mode
  agentSecrets:
    secretName: "agent-aws-secret"
    externalSecrets:
      data:
      - secretKey: AWS_ACCESS_KEY_ID
        remoteRef:
          key: secret/ai-platform-engineering/aws-secret
          property: AWS_ACCESS_KEY_ID
      - secretKey: AWS_SECRET_ACCESS_KEY
        remoteRef:
          key: secret/ai-platform-engineering/aws-secret
          property: AWS_SECRET_ACCESS_KEY
      - secretKey: AWS_REGION
        remoteRef:
          key: secret/ai-platform-engineering/aws-secret
          property: AWS_REGION

agent-backstage:
  nameOverride: "agent-backstage"
  image:
    repository: "ghcr.io/cnoe-io/agent-backstage"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-backstage"
      tag: "0.2.4"
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
  agentSecrets:
    secretName: "agent-backstage-secret"
    externalSecrets:
      data:
      - secretKey: BACKSTAGE_API_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/backstage-secret
          property: BACKSTAGE_API_TOKEN
      - secretKey: BACKSTAGE_URL
        remoteRef:
          key: secret/ai-platform-engineering/backstage-secret
          property: BACKSTAGE_URL

agent-confluence:
  nameOverride: "agent-confluence"
  image:
    repository: "ghcr.io/cnoe-io/agent-confluence"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-confluence"
      tag: "0.2.4"
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
  agentSecrets:
    secretName: "agent-confluence-secret"
    externalSecrets:
      data:
      - secretKey: ATLASSIAN_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/confluence-secret
          property: ATLASSIAN_TOKEN
      - secretKey: ATLASSIAN_EMAIL
        remoteRef:
          key: secret/ai-platform-engineering/confluence-secret
          property: ATLASSIAN_EMAIL
      - secretKey: CONFLUENCE_API_URL
        remoteRef:
          key: secret/ai-platform-engineering/confluence-secret
          property: CONFLUENCE_API_URL

agent-github:
  nameOverride: "agent-github"
  image:
    repository: "ghcr.io/cnoe-io/agent-github"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    useRemoteMcpServer: true
  agentSecrets:
    secretName: "agent-github-secret"
    externalSecrets:
      data:
      - secretKey: GITHUB_PERSONAL_ACCESS_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/github-secret
          property: GITHUB_PERSONAL_ACCESS_TOKEN

agent-jira:
  nameOverride: "agent-jira"
  image:
    repository: "ghcr.io/cnoe-io/agent-jira"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-jira"
      tag: "0.2.4"
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
  agentSecrets:
    secretName: "agent-jira-secret"
    externalSecrets:
      data:
      - secretKey: ATLASSIAN_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/jira-secret
          property: ATLASSIAN_TOKEN
      - secretKey: ATLASSIAN_EMAIL
        remoteRef:
          key: secret/ai-platform-engineering/jira-secret
          property: ATLASSIAN_EMAIL
      - secretKey: ATLASSIAN_API_URL
        remoteRef:
          key: secret/ai-platform-engineering/jira-secret
          property: ATLASSIAN_API_URL


agent-komodor:
  nameOverride: "agent-komodor"
  image:
    repository: "ghcr.io/cnoe-io/agent-komodor"
    pullPolicy: "Always"
    tag: "41c4392" # Use the latest fix that includes https://github.com/cnoe-io/ai-platform-engineering/pull/507. This is a temporary fix until the next release of the agent-komodor chart.
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-komodor"
      tag: "41c4392" # Use the latest fix that includes https://github.com/cnoe-io/ai-platform-engineering/pull/507. This is a temporary fix until the next release of the mcp-komodor chart.
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
  agentSecrets:
    secretName: "agent-komodor-secret"
    externalSecrets:
      data:
      - secretKey: KOMODOR_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/komodor-secret
          property: KOMODOR_TOKEN
      - secretKey: KOMODOR_API_URL
        remoteRef:
          key: secret/ai-platform-engineering/komodor-secret
          property: KOMODOR_API_URL

agent-pagerduty:
  nameOverride: "agent-pagerduty"
  image:
    repository: "ghcr.io/cnoe-io/agent-pagerduty"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-pagerduty"
      tag: "0.2.4"
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
  agentSecrets:
    secretName: "agent-pagerduty-secret"
    externalSecrets:
      data:
      - secretKey: PAGERDUTY_API_KEY
        remoteRef:
          key: secret/ai-platform-engineering/pagerduty-secret
          property: PAGERDUTY_API_KEY
      - secretKey: PAGERDUTY_API_URL
        remoteRef:
          key: secret/ai-platform-engineering/pagerduty-secret
          property: PAGERDUTY_API_URL

agent-slack:
  nameOverride: "agent-slack"
  image:
    repository: "ghcr.io/cnoe-io/agent-slack"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-slack"
      tag: "0.2.4"
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
    pullPolicy: "Always"
  agentSecrets:
    secretName: "agent-slack-secret"
    externalSecrets:
      data:
      - secretKey: SLACK_BOT_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/slack-secret
          property: SLACK_BOT_TOKEN
      - secretKey: SLACK_APP_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/slack-secret
          property: SLACK_APP_TOKEN
      - secretKey: SLACK_SIGNING_SECRET
        remoteRef:
          key: secret/ai-platform-engineering/slack-secret
          property: SLACK_SIGNING_SECRET
      - secretKey: SLACK_CLIENT_SECRET
        remoteRef:
          key: secret/ai-platform-engineering/slack-secret
          property: SLACK_CLIENT_SECRET
      - secretKey: SLACK_TEAM_ID
        remoteRef:
          key: secret/ai-platform-engineering/slack-secret
          property: SLACK_TEAM_ID

agent-splunk:
  nameOverride: "agent-splunk"
  image:
    repository: "ghcr.io/cnoe-io/agent-splunk"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-splunk"
      tag: "0.2.4"
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
  agentSecrets:
    secretName: "agent-splunk-secret"
    externalSecrets:
      data:
      - secretKey: SPLUNK_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/splunk-secret
          property: SPLUNK_TOKEN
      - secretKey: SPLUNK_API_URL
        remoteRef:
          key: secret/ai-platform-engineering/splunk-secret
          property: SPLUNK_API_URL

agent-webex:
  nameOverride: "agent-webex"
  image:
    repository: "ghcr.io/cnoe-io/agent-webex"
    pullPolicy: "Always"
    tag: "0.2.4"
  mcp:
    image:
      repository: "ghcr.io/cnoe-io/mcp-webex"
      tag: "0.2.4"
      pullPolicy: "Always"
    mode: "http" # Options: stdio, http
    port: 8000
  agentSecrets:
    secretName: "agent-webex-secret"
    externalSecrets:
      data:
      - secretKey: WEBEX_TOKEN
        remoteRef:
          key: secret/ai-platform-engineering/webex-secret
          property: WEBEX_TOKEN

rag-stack:
  rag-server:
    image:
      repository: "ghcr.io/cnoe-io/caipe-rag-server"
      tag: "0.2.4"
      pullPolicy: "Always"

  agent-rag:
    image:
      repository: "ghcr.io/cnoe-io/caipe-rag-agent-rag"
      tag: "0.2.4"
      pullPolicy: "Always"

  rag-webui:
    image:
      repository: "ghcr.io/cnoe-io/caipe-rag-webui"
      tag: "0.2.4"
      pullPolicy: "Always"
    ingress:
      enabled: true
      className: "nginx"
      hosts:
        - host: rag-webui.cnoe.localtest.me
          paths:
            - path: /
              pathType: Prefix
      tls:
        - hosts:
            - rag-webui.cnoe.localtest.me
          secretName: rag-webui-tls

  # Neo4j storage class override for KIND compatibility
  neo4j:
    volumes:
      data:
        mode: "dynamic"
        dynamic:
          storageClassName: standard  # Override from gp2 to standard for KIND

  # Neo4j Ontology storage class override for KIND compatibility
  neo4j-ontology:
    volumes:
      data:
        mode: "dynamic"
        dynamic:
          storageClassName: standard  # Override from gp2 to standard for KIND

  milvus:
    # Only override what differs from chart defaults
    pulsarv3:
      enabled: false  # Default is true, we need false
    woodpecker:
      enabled: true   # Default is false, we need true
